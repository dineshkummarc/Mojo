(function(f,d){var e=function(){};e.controllers={};e.applications={};e.options={};e._loaded=[];e._resolvedNamespace=function(a){return e._namespace._provided[""+a];};e.resolve=function(a){if(!e._namespace._provided[a]){return a.replace(/\./gi,"/");}return false;};e._namespace=function(i){var c=(""+i).split(/\./),a=c.length,b=[],l=window||{};if(!e._namespace._provided){e._namespace._provided={};}if(e._namespace._provided[i]==i){throw new Error(i+" has already been defined.");}for(var m=0;m<a;m+=1){var n=c[m];if(!l[n]){b[m]=n;l[n]=function(){};e._namespace._provided[b.join(".")]=l[n];}l=l[n];}return l;};e.query=function(){return jQuery.apply(this,arguments);};e.queryFirst=function(){return e.query.apply(this,arguments)[0];};e.require=function(n,b){if(!$.isArray(n)){n=[n];}var c=n.length,a=e.options.baseSrc,o=0;var r=e.controllers;for(var p=0;p<c;p++){var i=n[p];console.log(i);var a=e.options.baseSrc+e.resolve(i)+".js";e._loaded.push(i);$.getScript(a,function(){o++;});}var q=setInterval(function(){if(b&&o==c){clearInterval(q);b.call(this);}},25);};e.fetch=function(b,a){$.getScript(b,function(){if(a){a.apply(this,arguments);}});};e.define=function(a,b){if("function"==typeof b){b=b.call(this);}console.log("DEFINE: ",a);if(typeof a=="string"){e._namespace(a);e._loaded[a]=b;e.controllers[a]=b;}};e.create=function(a){if(typeof a=="undefined"){a={};if(!a.baseSrc){a.baseSrc="js/";}if(!a.mojoSrc){a.mojoSrc="../src";}}$.extend(this.options,a);return new Application();};e.extend=function(){var a=function(){};return function(b,c){a.prototype=c.prototype;b.prototype=new a();b.__super__=c.prototype;b.prototype.constructor=b;};};window.MOJO=e;})(window,document);MOJO.define("Request",function(){function b(f,a,g,h){this.paramsObj=f;this.callerObj=a;this.eventObj=g;this.controllerObj=h;}b.prototype.getController=function(){return this.controllerObj;};b.prototype.getContextElement=function(){return this.getController().getContextElement();};b.prototype.getCaller=function(){return this.callerObj;};b.prototype.getEvent=function(){return this.eventObj;};window.Request=b;return b;});MOJO.define("Controller",function(){function b(){this.contextElement=null;this.controllerClass=null;this.events;}b.prototype.onInit=function(){};b.prototype.onParamChange=function(){};b.prototype.initialize=function(h,g,f){var a=this;a.contextElement=h;a.controllerClass=g;a.params=f;$(a.events).each(function(e,m){var o=$(document),c=m[0],p=m[1],n=m[2],d=m[3];if(c=="context"){o=$(h);}$(o).delegate(p,n,function(i){var j=new Request({},this,i,a);if(typeof a.before!="undefined"&&typeof a.before[d]!="undefined"){a.before[d].call(a,j);}a.methods[d].call(a,j);if(typeof a.after!="undefined"&&typeof a.after[d]!="undefined"){a.after[d].call(a,j);}});});a.onInit();};b.prototype.getContextElement=function(){if(!this.contextElement){return null;}return this.contextElement;};b.prototype.param=function(a,d){if(arguments.length>1){this.params[a]=d;this.onParamChange();return this;}else{return this.params[a];}};window.Controller=b;return b;});MOJO.define("Application",function(){function b(){if(!this.options){this.options={};}var a=this,d=a.options;d.locale="en_CA";d.plugins=[];d.pluginSrc="js/lib/plugins/";d.environment="dev";d.selector=jQuery||(function(){throw new Error("Unable to find jQuery");})();a.siteMap=[];}b.prototype.onComplete=function(){};b.prototype.configure=function(a,e){if(arguments.length>1){this.options[a]=e;if(this.options.environment=="dev"){try{console.info("Configure: ",a," -> ",e);}catch(f){}}return this;}else{return this.options[a];}};b.prototype.map=function(a,f){var h=this;var g=$(a);g.each(function(d,c){h.siteMap.push({context:c,init:f});});f.call(this,h);return this;};b.prototype.heal=function(){return this;};b.prototype.setupController=function(l,a,h){var j=$(l);var k=MOJO.controllers[a],i=new Controller(),k=$.extend(k,i);MOJO.controllers[a]=k;if(typeof k=="undefined"){throw new Error("Undefined Controller @ ",a);}k.initialize(l,a,h);if(typeof k.after!="undefined"&&k.after.Start!="undefined"){k.after.Start.call(k,null);}};b.prototype.disconnectControllers=function(d){var a=this;$(a.siteMap).each(function(f,c){$(c.context).unbind().undelegate();});d.apply(a);};b.prototype.connectControllers=function(){var a=this,d=[];$(a.siteMap).each(function(g,h){var c=h.init.call(this);$(c).each(function(f,e){if(!MOJO.controllers.hasOwnProperty(e.controller)){d.push(e.controller);}else{MOJO._loaded[e.controller]=e.controller;}});});MOJO.require($.unique(d),function(){$(a.siteMap).each(function(i,j){if(a.options.environment=="dev"){try{console.log("Mapping: ",j.context);}catch(c){}}var h=j.init.call(this);$(h).each(function(f,e){a.setupController(j.context,e.controller,e.params);});});});};b.prototype.on=function(a,d){return function(){};};b.prototype.getPlugins=function(e){var a=this,f=a.options.pluginSrc;$(a.options.plugins).each(function(d,c){MOJO.fetch(f+c+".js");});e.call(a);};b.prototype.start=function(){var a=this;$(document).ready(function(){a.disconnectControllers(function(){if(a.options.plugins.length){a.getPlugins(function(){a.connectControllers();});}else{a.connectControllers();}a.onComplete();});});};window.Application=b;return b;});MOJO.define("Service",function(){function b(h,g,a){if(typeof a=="undefined"){a={};}var f={method:a.method||function(){var c="get";if(h.match(/^get/i)){c="get";}else{if(h.match(/^add|del|update/i)){c="post";}}return c;}(),template:false};this.name=h;this.uri=g;this.options=$.extend({},f,a);}b.prototype.invoke=function(l,j,n){var a=this;var o=this.getOptions()||{},k=o.method,m=a.getURI(),p=o.responseType||"JSON";if(o.template){m=$.tmpl(m,l);l=null;}$.ajaxSetup({dataTypeString:p,type:k,cache:o.cache||"false",contentType:"application/json; charset=utf-8"});$.ajax({url:m,data:l}).success(function(c){if(p=="JSON"){c=$.parseJSON(c);}if(typeof j=="function"){j.call(n,null,c);}else{n[j](null,c);}}).error(function(){j.call(n,"Unable to execute XHR",arguments);});};b.prototype.getName=function(){return this.name;};b.prototype.getURI=function(){return this.uri;};b.prototype.getOptions=function(){return this.options;};b.prototype.option=function(){if(arguments.length>1){this.options[arguments[0]]=arguments[1];return this;}else{return this.options[arguments[0]];}};window.Service=b;return b;});MOJO.define("ServiceLocator",function(){var b={services:{},addService:function(a){this.services[a.name]=a;return this;},getService:function(a){return this.services[a];},removeService:function(a){delete this.services[a];},removeServices:function(){this.services={};}};window.ServiceLocator=b;return b;});MOJO.define("ExampleApp.LoginController",{events:[["context",".btn-login","click","Login"],["context",".btn-logout","click","Logout"]],methods:{Login:function(b){var a=b.getContextElement();alert("Logged in from "+this.controllerClass);},Logout:function(a){alert("Logged out from "+this.controllerClass);}},before:{Login:function(){console.log("[intercept] Before Login");}},after:{Start:function(){},Login:function(){console.log("[intercept] After Login");}}});MOJO.define("ExampleApp.RegistrationController",{events:[["context",".btn-submit-registration","click","Register"],["dom",".btn-test-outside","click","Register"]],methods:{Register:function(b){var a=b.getContextElement();alert("REGISTER from "+this.controllerClass);}}});MOJO.define("ExampleApp.GalleryController",{events:[],methods:{},after:{Start:function(){$("#mycarousel",this.getContextElement()).jcarousel();}}});MOJO.define("ExampleApp.member.ProfileController",{events:[["context",".btn-save-profile","click","Save"]],methods:{Save:function(b){var a={};$("input[type=text], textarea").each(function(d,c){c=$(c);a[c.attr("name")]=c.val();});ServiceLocator.getService("UpdateProfile").invoke(a,function(c,d){console.log("Success!");$(".success",this.getContextElement()).show("fast");},this);}},after:{Start:function(){var a=this;$.each(this.params,function(b,c){$("input[name='"+b+"']",a.getContextElement()).val(c);});}}});ServiceLocator.addService(new Service("UpdateProfile","data/success.json"));var app=MOJO.create({mojoSrc:"../src",baseSrc:"js/"});app.configure("appName","ExampleApp").configure("locale","en_US").configure("environment","prod").configure("pluginSrc","js/lib/plugins/").configure("plugins",["jqmodal","jcarousel","pubsub"]).configure("selector",jQuery.sub()).map("#registration-example",function(){return[{controller:"ExampleApp.RegistrationController",params:{user:123,firstName:"Johnson"}}];}).map("#login-example",function(){return[{controller:"ExampleApp.LoginController"}];}).map("#profile-example",function(){return[{controller:"ExampleApp.member.ProfileController",params:{currentCity:"Vancouver",hometown:"Winnipeg"}}];}).map("#gallery-example",function(){return[{controller:"ExampleApp.GalleryController"}];}).start();