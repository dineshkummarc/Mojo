/*
 * The Blast Mojo Framework
 *
 * Copyright (c) 2011 Blast Radius
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */
(function(c,b){var a=function(){};a._loaded=[];a._resolvedNamespace=function(d){return a._namespace._provided[""+d];};a._namespace=function(g){var h=(""+g).split(/\./),k=h.length,j=[],f=window||{};if(!a._namespace._provided){a._namespace._provided={};}if(a._namespace._provided[g]==g){throw new Error(g+" has already been defined.");}for(var e=0;e<k;e+=1){var d=h[e];if(!f[d]){j[e]=d;f[d]=function(){};a._namespace._provided[j.join(".")]=f[d];}f=f[d];}return f;};a.controllers={};a.query=function(){return jQuery.apply(this,arguments);};a.queryFirst=function(){return a.query.apply(this,arguments)[0];};a.require=function(){};a.fetch=function(d,e){$.ajaxSetup({async:false});$.getScript(d,function(){if(e){e.apply(this,arguments);}});$.ajaxSetup({async:true});};a.define=function(){var f=arguments,d=f.length;for(var g=0;g<d;g++){if(typeof f[g]=="function"){f[g]=f[g].call(this);}}var e;console.log(f);if(typeof f[0]=="string"){e=a._namespace(f[0]);a.controllers[f[0]]=e;}};a.create=function(d){return new Application(d);};window.MOJO=a;})(window,document);MOJO.define("Request",[],function(){function a(e,b,d,c){this.paramsObj=e;this.callerObj=b;this.eventObj=d;this.controllerObj=c;}a.prototype.getController=function(){return this.controllerObj;};a.prototype.getContextElement=function(){return this.getController().getContextElement();};a.prototype.getCaller=function(){return this.callerObj;};a.prototype.getEvent=function(){return this.eventObj;};window.Request=a;return a;});MOJO.define("Controller",[],function(){function a(){this.contextElement=null;this.controllerClass=null;this.delegates=[];this.events;}a.prototype.onInit=function(){};a.prototype.initialize=function(c,d,e){var b=this;b.contextElement=c;b.controllerClass=d;b.params=e;$(b.events).each(function(j,i){var g=$(document),l=i[0],f=i[1],h=i[2],k=i[3];if(l=="context"){g=$(c);}$(g).delegate(f,h,function(m){var n=new Request({},this,m,b);if(typeof b.before!="undefined"&&typeof b.before[k]!="undefined"){b.before[k].call(b,n);}b.methods[k].call(b,n);if(typeof b.after!="undefined"&&typeof b.after[k]!="undefined"){b.after[k].call(b,n);}});});b.onInit();};a.prototype.getContextElement=function(){if(!this.contextElement){return null;}return this.contextElement;};a.prototype.param=function(b,c){if(arguments.length>1){this.params[b]=c;return this;}else{return this.params[b];}};window.Controller=a;return a;});MOJO.define("Application",[],function(){function a(){if(!this.options){this.options={};}var b=this,c=b.options;c.appSrc="js/";c.locale="en_CA";c.plugins=[];c.pluginSrc="js/lib/plugins/";c.environment="dev";c.selector=jQuery||(function(){throw new Error("Unable to find jQuery");})();b.siteMap=[];}a.prototype.onComplete=function(){};a.prototype.configure=function(b,d){if(arguments.length>1){this.options[b]=d;try{console.info("Configure: ",b," -> ",d);}catch(c){}return this;}else{return this.options[b];}};a.prototype.map=function(b,e){var c=this;var d=$(b);d.each(function(f,g){c.siteMap.push({context:g,init:e});});e.call(this,c);return this;};a.prototype.heal=function(){return this;};a.prototype.setupController=function(d,c,h){var f=$(d);var e=MOJO.controllers[c],g=new Controller(),e=$.extend(e,g);MOJO.controllers[c]=e;if(typeof e=="undefined"){throw new Error("Undefined Controller @ ",c);}e.initialize(d,c,h);var b={name:c,controller:e};if(typeof e.after!="undefined"&&e.after.Start!="undefined"){e.after.Start.call(e,null);}};a.prototype.disconnectControllers=function(c){var b=this;$(b.siteMap).each(function(d,e){$(e.context).unbind();});c.apply(b);};a.prototype.connectControllers=function(){var b=this;$(b.siteMap).each(function(d,c){if(b.options.environment=="dev"){try{console.log("Mapping: ",c.context);}catch(f){}}var e=c.init.call(this);$(e).each(function(h,m){var g=c.context,j=$(g),l=m.params,k=m.controller;if(!MOJO._loaded.length||$.inArray(m.controller,MOJO._loaded)==-1){MOJO.fetch(b.options.appSrc+(k.replace(/\./g,"/")+".js"),function(i){console.log("Loaded Controller: ",k);b.setupController(g,k,l);});}else{b.setupController(g,k,l);}MOJO._loaded.push(k);});});};a.prototype.on=function(b,c){return function(){};};a.prototype.getPlugins=function(d){var b=this,c=b.options.pluginSrc;$(b.options.plugins).each(function(e,f){MOJO.fetch(c+f+".js");});d.call(b);};a.prototype.start=function(){var b=this;$(document).ready(function(){b.disconnectControllers(function(){if(b.options.plugins.length){b.getPlugins(function(){b.connectControllers();});}else{b.connectControllers();}b.onComplete();});});};window.Application=a;return a;});MOJO.define("Service",[],function(){function a(c,d,b){this.name=c;this.uri=d;this.options=b;}a.prototype.invoke=function(g,i,e){var b=this;var d=this.getOptions()||{},h=d.method||function(){var j="get";if(b.getName().match(/^get/i)){j="get";}else{if(b.getName().match(/^add|del|update/i)){j="post";}}return j;}(),f=this.uri||"/api",c=d.responseType||"JSON";if(d.template){f=$.tmpl(f,g);g=null;}$.ajaxSetup({dataTypeString:c,type:h,cache:d.cache||"false",contentType:"application/json; charset=utf-8"});$.ajax({url:f,data:g}).success(function(j){if(c=="JSON"){j=$.parseJSON(j);}if(typeof i=="function"){i.call(e,null,j);}else{e[i](null,j);}}).error(function(){i.call(e,"Unable to execute XHR",arguments);});};a.prototype.getName=function(){return this.name;};a.prototype.getURI=function(){return this.uri;};a.prototype.getOptions=function(){return this.options;};window.Service=a;return a;});MOJO.define("ServiceLocator",[],function(){var a={services:{},addService:function(b){this.services[b.name]=b;return this;},getService:function(b){return this.services[b];},removeService:function(b){delete this.services[b];},removeServices:function(){this.services={};}};window.ServiceLocator=a;return a;});